<div class="container">
  
  <!-- First screen: choose to edit or create new -->
  <div *ngIf="step == 1">

    <h2>Choose type to edit or create new one</h2>

    <div class="added_item" *ngFor="let offer of offer_types | async">

      <p>{{offer.title}} - ({{offer.start_time}}s - {{offer.end_time}}s)</p>

      <span style="cursor: pointer" (click)="edit_type(offer)">
        <mat-icon aria-hidden="false" aria-label="edit icon">edit</mat-icon>
      </span>

      <span style="cursor: pointer" (click)="delete_type(offer)">
        <mat-icon aria-hidden="false" aria-label="delete icon">delete</mat-icon>
      </span>
    </div>

    <br/>

    <button mat-stroked-button (click)="move_step(2)">Create New</button>
  </div>

  <!-- Second screen: select base to create new -->
  <div *ngIf="step == 2">

    <h2>Select base to use:</h2>
    <mat-spinner *ngIf="(bases | async).length == 0"></mat-spinner>

    <div class="added_item" *ngFor="let base of bases | async | keyvalue" (click)="choose_base(base.key)">
      <p>{{base.key}}</p>
    </div>
  </div>

  <!-- Spinner -->
  <mat-spinner *ngIf="video_url && !video"></mat-spinner>
  
  <!-- Configure chosen base video -->
  <div [hidden]="!video">

      <video #vd1 *ngIf="video_url" class="video" (canplay)="on_video_loaded(vd1)" muted>
        <source [src]="video_url" type="video/mp4">
      </video>

      <br><br>
      
      <button mat-stroked-button id="play" (click)="play_pause()">Play/Pause</button>

      <br/><br/>

      <button mat-stroked-button id="secondback" (click)="go_seconds_back(1)">Fast Back</button>
      <button mat-stroked-button id="secondback" (click)="go_seconds_back(0.1)">Back</button>
      <span id="seconds">{{seconds}}</span>
      <button mat-stroked-button id="secondforward" (click)="go_seconds_forward(0.1)">Forward</button>
      <button mat-stroked-button id="secondforward" (click)="go_seconds_forward(1)">Fast Forward</button>
      
      <br/><br/>

      <!-- Offer Type -->
      <mat-form-field class="example-full-width">
        <mat-label>Title</mat-label>
        <input [(ngModel)]="offer_type.title" matInput >
      </mat-form-field>

      <mat-form-field class="example-full-width">
        <mat-label>Start Time</mat-label>
        <input [(ngModel)]="offer_type.start_time" type="number" matInput >
      </mat-form-field>

      <mat-form-field class="example-full-width">
        <mat-label>End Time </mat-label>
        <input [(ngModel)]="offer_type.end_time" type="number" matInput >
      </mat-form-field>

      <!-- Add New Items -->
      <h2>Add New Item</h2>
      
      <!-- Choose type -->
      <mat-form-field>
        <mat-label>Insert new</mat-label>
        <mat-select [(ngModel)]="current_product.product" (selectionChange)="select_element()">
          <mat-option *ngFor="let item_option of ['Product', 'Asset']" [value]="item_option.product">
            {{item_option.title}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <!-- Choose field -->
      <mat-form-field *ngIf="current_product.product != undefined">
        <mat-label>Field to Insert</mat-label>
        <mat-select [(ngModel)]="current_product.field" (selectionChange)="select_field(current_product.field)">
          <mat-option *ngFor="let field_option of field_options" [value]="field_option">
            {{field_option}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <!-- Example of content to place on top of video -->
      <mat-form-field *ngIf="current_product.field && contents.length > 0">
        <mat-label>Example</mat-label>
        <mat-select #content (selectionChange)="select_example(content.value)">
          <mat-option *ngFor="let content of contents" [value]="content">
            {{current_product.field == 'image' ? content.content.split('/').pop() : content.content}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      
      <br/>
      
      <!-- Text -->
      <div *ngIf="current_product.field">
        <div *ngIf="['title', 'price', 'custom'].indexOf(current_product.field) >= 0">
          
          <mat-form-field>
            <mat-label>Font</mat-label>
            <mat-select [(ngModel)]="current_product.font">
              <mat-option *ngFor="let f of facade.fonts$ | async | keyvalue" [value]="f.key">
                {{f.key}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          <input [(ngModel)]="current_product.color"
          [style.background]="current_product.color"
          [(colorPicker)]="current_product.color"/> 
          
          <mat-form-field class="example-full-width">
            <mat-label>Font size</mat-label>
            <input [(ngModel)]="current_product.size" type="number" matInput placeholder="size">
          </mat-form-field>
          
          <mat-form-field class="example-full-width">
            <mat-label>Width (letters)</mat-label>
            <input [(ngModel)]="current_product.width" type="number" matInput placeholder="width">
          </mat-form-field>
          
          <mat-form-field>
            <mat-label>Align</mat-label>
            <mat-select [(ngModel)]="current_product.align" value="center">
              <mat-option *ngFor="let a of ['center', 'left', 'right']" [value]="a">
                {{a}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          <mat-form-field class="example-full-width">
            <mat-label>Angle</mat-label>
            <input [(ngModel)]="current_product.angle" type="number" matInput placeholder="angle">
          </mat-form-field>
          
          <br/>
          
          <button mat-stroked-button (click)="create_text()">Insert Text</button>
        </div>
        
        <!-- Image -->
        <div *ngIf="current_product.field == 'image'">
          
          <mat-form-field class="example-full-width">
            <mat-label>Width</mat-label>
            <input [(ngModel)]="current_product.width" type="number" matInput placeholder="width">
          </mat-form-field>
          
          <mat-form-field class="example-full-width">
            <mat-label>Height</mat-label>
            <input [(ngModel)]="current_product.height" type="number" matInput placeholder="height">
          </mat-form-field>
          
          <mat-form-field>
            <mat-label>Align</mat-label>
            <mat-select [(ngModel)]="current_product.align">
              <mat-option *ngFor="let a of ['center', 'left']" [value]="a">
                {{a}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          
          <br/>
          
          <button mat-stroked-button (click)="create_image()">Insert Image</button>
        </div>
      </div>
      
      <br/>

      <!-- Added Items -->
      <h2>{{offer_type.configs.length}} added items</h2>
      
      <!--div *ngIf="base">
        <div class="added_item" *ngFor="let item of offer_type.configs | keyvalue">
        
          <p>{{item.value.length}} itens added</p>

          <span style="cursor: pointer" (click)="edit_row(item.key)">
            <mat-icon aria-hidden="false" aria-label="edit icon">edit</mat-icon>
          </span>

          <span style="cursor: pointer" (click)="delete_row(item.key)">
            <mat-icon aria-hidden="false" aria-label="delete icon">delete</mat-icon>
          </span>

        </div>
      </div-->

      <br/><br/>
      
      <button mat-stroked-button (click)="finish()">Save</button>
      
      <!-- Items on screen -->
      <div *ngFor="let el of text_elements">
        <div 
        id="{{el.id}}" 
        innerHTML={{el.content}}
        draggable="true" 
        [ngStyle]="{
          'color': el.color,
          'font-size': el.size + 'px',
          'font-family': el.font_family,
          'text-align': el.align,
          'position': 'absolute',
          'line-height': el.size * 1.2 + 'px',
          'top': '500px',
          'left': '500px',
          'transform': 'rotate(' + el.angle + 'deg)'
        }"
        >{{el.content}}</div>
      </div>
      
      <div *ngFor="let el of image_elements">
        <img 
        id="{{el.id}}" 
        src={{el.content}}
        width={{el.width}}
        height={{el.height}}
        draggable="true" 
        [ngStyle]="{
          'position': 'absolute',
          'top': '500px',
          'left': '500px',
          'transform': 'rotate(' + el.angle + 'deg)'
        }"/>
      </div>

    </div>
  </div>